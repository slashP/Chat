@model dynamic

<script type="text/javascript">
    $(document).ready(function () {
        var user = "@(User.Identity.Name)";
        $(function () {
            var conChat = $.connection.chat;
            conChat.addMessage = function (message) {
                if (message !== '') {
                    $("#disMess").children("div:gt(40)").remove();
                    $('#disMess').prepend('<div class="row chatMessage"><div class="user">' + message.User + '</div><div class="time">' + message.Time + '</div><div class="message">' + message.Message + '</div></div>');
                }
            };
            
            conChat.addAllMessages = function (messages) {
                for (var i = 0; i < messages.length; i++) {
                    var message = messages[i];
                    this.addMessage(message);
                }
            };

            $("#txtMess").keyup(function (event) {
                if (event.keyCode == 13) {
                    if ($('#txtMess').val() !== '') {
                        conChat.send({ User: user, Message: $('#txtMess').val() });
                        $('#txtMess').val('');
                    }
                }
            });

            $("#btnSend").click(function () {
                if ($('#txtMess').val() !== '') {
                    conChat.send({ User: user, Message: $('#txtMess').val() });
                    $('#txtMess').val('');
                }
            });

            $.connection.hub.start(function () {
                conChat.getAllMessages();
            });
        });
        
    });
   
</script>
<h3>Chat</h3>
<input type="text" id="txtMess" style="width: 300px; height: 40px;"/>
<input type="button" id="btnSend" value="Send" />
<div id="disMess"></div>
